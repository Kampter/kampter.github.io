<!doctype html><html lang=en><head><title>URP仿原神渲染shader</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=HandheldFriendly content="true"><meta name=author content="bslthemes"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Poppins:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i"><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.8.0/css/all.css><link rel=stylesheet href=https://kampter.github.io/scss/style.min.css><link rel=stylesheet href=https://kampter.github.io/plugins/ionicons/ionicons.css><link rel=stylesheet href=https://kampter.github.io/plugins/font-awesome/css/font-awesome.css><link rel=stylesheet href=https://kampter.github.io/plugins/magnific-popup/magnific-popup.css><link rel=stylesheet href=https://kampter.github.io/plugins/owl-carousel/owl.carousel.css><link rel=stylesheet href=https://kampter.github.io/plugins/animate/animate.css><link rel=stylesheet href=https://kampter.github.io/plugins/syntax/syntax.css><link rel="shortcut icon" href=https://kampter.github.io/images/favicon/favicon.ico type=image/x-icon><link rel=icon href=https://kampter.github.io/images/favicon/favicon.ico type=image/x-icon><script async src="https://www.googletagmanager.com/gtag/js?id=G-4BGKQYLBBG"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-4BGKQYLBBG")</script></head><body class=blog><div class="page new-skin"><div class=preloader><div class="centrize full-width"><div class=vertical-center><div class=spinner><div class=double-bounce1></div><div class=double-bounce2></div></div></div></div></div><div class="background gradient"><ul class=bg-bubbles><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul></div><div class=s_overlay></div><div class=content-sidebar><div class=sidebar-wrap><aside id=secondary class=widget-area><div id=search class="widget widget_search"><form class=search-form action=https://kampter.github.io/search><label><input type=search id=searchInput class=search-field placeholder="Search ..."></label>
<input type=submit class=search-submit><ul id=searchResults></ul></form></div><section class="widget widget_menu"><h2 class=widget-title>Menu</h2><ul><li class=active><a href=https://kampter.github.io//blog>Blog Page</a></li><li><a href=https://kampter.github.io//portfolio>Portfolio Page</a></li></ul></section><section class="widget widget_recent_entries"><h2 class=widget-title>Latest Posts</h2><ul><li><a href=https://kampter.github.io/blog/%E8%BF%91%E6%9C%9F%E5%81%9A%E7%9A%84%E5%87%A0%E4%B8%AAunity%E5%92%8Cue%E7%89%B9%E6%95%88/>近期做的几个Unity和UE特效</a></li><li><a href=https://kampter.github.io/blog/urp%E5%B1%8F%E5%B9%95%E7%A9%BA%E9%97%B4sobel%E8%BE%B9%E7%BC%98%E6%A3%80%E6%B5%8B/>URP屏幕空间Sobel边缘检测</a></li><li><a href=https://kampter.github.io/blog/blender%E6%8F%92%E4%BB%B6%E5%88%B6%E4%BD%9C%E5%BF%83%E5%BE%97/>Blender插件制作心得</a></li><li><a href=https://kampter.github.io/blog/urp%E5%B1%8F%E5%B9%95%E7%A9%BA%E9%97%B4%E7%8E%AF%E5%A2%83%E5%85%89%E9%81%AE%E8%94%BD/>URP屏幕空间环境光遮蔽</a></li></ul></section><section class="widget widget_categories"><h2 class=widget-title>Categories</h2><ul><li><a href=https://kampter.github.io/categories/portfolio/>Portfolio</a>
<small>( 2 )</small></li><li><a href=https://kampter.github.io/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/>学习笔记</a>
<small>( 2 )</small></li><li><a href=https://kampter.github.io/categories/%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0/>技术实现</a>
<small>( 9 )</small></li><li><a href=https://kampter.github.io/categories/%E6%97%A5%E5%B8%B8%E7%94%9F%E6%B4%BB/>日常生活</a>
<small>( 2 )</small></li><li><a href=https://kampter.github.io/categories/%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/>课程笔记</a>
<small>( 9 )</small></li></ul></section><section class="widget widget_tags"><h2 class=widget-title>Tags</h2><ul><li><a href=https://kampter.github.io/tags/after-effect/>After Effect</a>
<small>( 1 )</small></li><li><a href=https://kampter.github.io/tags/bifrost/>Bifrost</a>
<small>( 1 )</small></li><li><a href=https://kampter.github.io/tags/blender/>blender</a>
<small>( 1 )</small></li><li><a href=https://kampter.github.io/tags/c#/>C#</a>
<small>( 4 )</small></li><li><a href=https://kampter.github.io/tags/computer-graphic/>Computer Graphic</a>
<small>( 9 )</small></li><li><a href=https://kampter.github.io/tags/eve-online/>Eve Online</a>
<small>( 1 )</small></li><li><a href=https://kampter.github.io/tags/flip/>Flip</a>
<small>( 1 )</small></li><li><a href=https://kampter.github.io/tags/games-101/>Games 101</a>
<small>( 4 )</small></li><li><a href=https://kampter.github.io/tags/games-202/>Games 202</a>
<small>( 3 )</small></li><li><a href=https://kampter.github.io/tags/hlsl/>HLSL</a>
<small>( 11 )</small></li><li><a href=https://kampter.github.io/tags/houdini/>Houdini</a>
<small>( 3 )</small></li><li><a href=https://kampter.github.io/tags/java/>Java</a>
<small>( 1 )</small></li><li><a href=https://kampter.github.io/tags/math/>Math</a>
<small>( 8 )</small></li><li><a href=https://kampter.github.io/tags/maya/>Maya</a>
<small>( 1 )</small></li><li><a href=https://kampter.github.io/tags/niagara-system/>Niagara System</a>
<small>( 1 )</small></li><li><a href=https://kampter.github.io/tags/opengl/>Opengl</a>
<small>( 1 )</small></li><li><a href=https://kampter.github.io/tags/particle/>Particle</a>
<small>( 1 )</small></li><li><a href=https://kampter.github.io/tags/pbr-shading/>PBR Shading</a>
<small>( 2 )</small></li><li><a href=https://kampter.github.io/tags/plugin/>plugin</a>
<small>( 1 )</small></li><li><a href=https://kampter.github.io/tags/profiling/>Profiling</a>
<small>( 1 )</small></li><li><a href=https://kampter.github.io/tags/render-feature/>Render Feature</a>
<small>( 4 )</small></li><li><a href=https://kampter.github.io/tags/shader-graph/>Shader Graph</a>
<small>( 1 )</small></li><li><a href=https://kampter.github.io/tags/substance-designer/>Substance Designer</a>
<small>( 1 )</small></li><li><a href=https://kampter.github.io/tags/toon-shading/>Toon Shading</a>
<small>( 3 )</small></li><li><a href=https://kampter.github.io/tags/unity/>Unity</a>
<small>( 12 )</small></li><li><a href=https://kampter.github.io/tags/unreal-engine/>Unreal Engine</a>
<small>( 1 )</small></li><li><a href=https://kampter.github.io/tags/upr/>UPR</a>
<small>( 1 )</small></li><li><a href=https://kampter.github.io/tags/vfx-graph/>VFX graph</a>
<small>( 1 )</small></li></ul></section></aside></div><span class=close></span></div><div class="container opened" data-animation-in=fadeInLeft data-animation-out=fadeOutLeft><header class=header><a href=# class=menu-btn><span></span></a><div class=top-menu><ul><li class=active><a href=https://kampter.github.io/#about-card><span class="icon ion-person"></span>
<span class=link>About</span></a></li><li><a href=https://kampter.github.io/#resume-card><span class="icon ion-android-list"></span>
<span class=link>Resume</span></a></li><li><a href=https://kampter.github.io/#works-card><span class="icon ion-paintbrush"></span>
<span class=link>Works</span></a></li><li><a href=https://kampter.github.io/#blog-card><span class="icon ion-chatbox-working"></span>
<span class=link>Blog</span></a></li><li><a href=https://kampter.github.io/#contact-card><span class="icon ion-at"></span>
<span class=link>Contact</span></a></li></ul></div></header><div class=card-started id=home-card><div class="profile no-photo"><div class=slide style=background-image:url(https://kampter.github.io/images/1082264.png)></div><div class=title>王子正</div><div class="subtitle subtitle-typed"><div class=typing-title><p>Technical Artist</p></div></div><div class=social><a target=_blank href=https://twitter.com/wang_psbswsg title=Twitter><span class="fab fa-twitter"></span></a>
<a target=_blank href=https://github.com/Kampter title=GitHub><span class="fab fa-github"></span></a>
<a target=_blank href=https://www.youtube.com/channel/UCK43eUkmsyRk8FeBw5oRJtQ title=Youtube><span class="fab fa-youtube"></span></a>
<a target=_blank href=https://www.artstation.com/kampter title=Stackoverflow><span class="fab fa-artstation"></span></a></div><div class=lnks><a href=/images/Resume_ZizhengWang_Chinese_v004.pdf target=_blank class=lnk><span class=text>Download CV</span>
<span class="ion ion ion-archive"></span></a>
<a href=mailto:psbswsg@gmail.com target=_blank class=lnk><span class=text>Contact Me</span>
<span class="ion arrow"></span></a></div></div></div><div class="card-inner blog blog-post animated" id=blog-card><div class=card-wrap><div class="content blog-single"><div class=title>Blog Post</div><div class="row border-line-v"><div class="col col-m-12 col-t-12 col-d-12"><div class=post-box><h1>URP仿原神渲染shader</h1><div class=blog-detail><span class=date>February 5, 2023</span>
<span class=cat-links><a href=https://kampter.github.io/categories/%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0/>技术实现</a></span>
<span class=byline>By <span class=author>Ryan Adlard</span></span></div><div class=blog-image><img src=https://kampter.github.io/images/blog/image-20230220105004875.png alt=URP仿原神渲染shader></div><div class=blog-content><h2 id=技术实现>技术实现</h2><p>在原神二测就有来体验过游戏，也是一步一步看着原神成长壮大封神的，一直以来都对于这样认真做内容的游戏公司怀有敬意。这次终于“敢”在掌握一定技术的情况下来模仿原神的渲染效果。</p><h3 id=模型准备>模型准备</h3><p>模型下载自米哈游官方在B站开展的二创活动pmx格式，直接网上随便找个converter即可转为fbx方便使用，这里选择刻晴作为测试人物模型。而神奇的google有人通过神奇的方式获得其他的贴图文件。汇总起来一共获得这些文件：</p><p><img src=image-20230218220545641.png alt></p><h3 id=贴图分析>贴图分析</h3><p><img src=image-20230218220828197.png alt=Lightmap.r><img src=image-20230218220928101.png alt=Lightmap.g></p><p>Lightmap.r = Specular Mask</p><p>Lightmap.g = AO Map</p><p><img src=image-20230218221112035.png alt=Lightmap.b><img src=image-20230218221128126.png alt=lightmap.a></p><p>Lightmap.b = Roughness</p><p>lightmap.a = Emission Mask</p><p><img src=image-20230218221323235.png alt><img src=image-20230218215709325.png alt></p><p>diffuse.a 在脸部，肌肉和上衣打底部分是由不为1的数值的</p><p><img src=image-20230218221653598.png alt><img src=image-20230218221715972.png alt></p><p>两张Ramp贴图让我想到军团要塞2中的wrapdiffuse处理，思路应该类似。而大佬们的文章表示贴图里有十条Ramp，分为上下各五条 分别对应白天和晚上。</p><h3 id=贴图和基础计算准备>贴图和基础计算准备</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-HLSL data-lang=HLSL><span style=display:flex><span><span style=color:#75715e>// Direction Function</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>half3</span> viewDirWS <span style=color:#f92672>=</span> GetWorldSpaceViewDir(IN.positionWS);
</span></span><span style=display:flex><span><span style=color:#66d9ef>half3</span> normalWS <span style=color:#f92672>=</span> IN.normalWS;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Light Calculation</span>
</span></span><span style=display:flex><span>Light mainLight <span style=color:#f92672>=</span> GetMainLight(); 
</span></span><span style=display:flex><span><span style=color:#66d9ef>half4</span> lightColor <span style=color:#f92672>=</span> <span style=color:#66d9ef>half4</span>(mainLight.color, <span style=color:#ae81ff>1</span>); <span style=color:#75715e>//获取主光源颜色</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>half3</span> lightDir <span style=color:#f92672>=</span> normalize(mainLight.direction); <span style=color:#75715e>//主光源方向</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Albedo</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>half4</span> albedo <span style=color:#f92672>=</span> SAMPLE_TEXTURE2D(_MainTex, sampler_MainTex, IN.uv); 
</span></span><span style=display:flex><span><span style=color:#66d9ef>half4</span> vertexColor <span style=color:#f92672>=</span> IN.vertexColor; <span style=color:#75715e>//顶点色</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Texture Sampling</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// lightmap</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// R channel = Specular Mask</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// G channel = AO Map</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// B channel = Roughness</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// A channel = Emission Mask</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 灰度1.0 ： 皮肤质感/头发质感（头发的部分是没有皮肤的）</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 灰度0.7 ： 丝绸/丝袜</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 灰度0.5 ： 金属/金属投影</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 灰度0.3 ： 软的物体</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 灰度0.0 ： 硬的物体</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>half4</span> lightMap <span style=color:#f92672>=</span> SAMPLE_TEXTURE2D(_LightMap, sampler_LightMap, IN.uv); 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Dot Product Function</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>half</span> ndotL <span style=color:#f92672>=</span> max(<span style=color:#ae81ff>0</span>, dot(normalWS, lightDir));
</span></span><span style=display:flex><span><span style=color:#66d9ef>half</span> ndotH <span style=color:#f92672>=</span> max(<span style=color:#ae81ff>0</span>, dot(normalWS, normalize(viewDirWS <span style=color:#f92672>+</span> lightDir)));
</span></span><span style=display:flex><span><span style=color:#66d9ef>half</span> ndotV <span style=color:#f92672>=</span> max(<span style=color:#ae81ff>0</span>, dot(normalWS, viewDirWS));
</span></span><span style=display:flex><span><span style=color:#66d9ef>half</span> ndotU <span style=color:#f92672>=</span> max(<span style=color:#ae81ff>0</span>, dot(normalWS, (<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1.0</span>, <span style=color:#ae81ff>0</span>)));
</span></span></code></pre></div><h3 id=adjusted-halflambert>Adjusted HalfLambert</h3><p>基础的半兰伯特模型，加上用定点色做调整。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-HLSL data-lang=HLSL><span style=display:flex><span><span style=color:#75715e>//lambert</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>half</span> lambert <span style=color:#f92672>=</span> ndotL;
</span></span><span style=display:flex><span><span style=color:#66d9ef>half</span> lambertAO <span style=color:#f92672>=</span> lambert <span style=color:#f92672>*</span> saturate(lightMap.g <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>half</span> lambertRampAO <span style=color:#f92672>=</span> smoothstep(<span style=color:#ae81ff>0</span>, _ShadowSmooth, lambertAO);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// using vertex color as an offset to adjust half lambert sampling</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>half</span> halfLambertAO <span style=color:#f92672>=</span> saturate(lambertRampAO <span style=color:#f92672>*</span> _WrapDiffuse <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>-</span> _WrapDiffuse);
</span></span><span style=display:flex><span><span style=color:#66d9ef>half</span> vertexOffset <span style=color:#f92672>=</span> step(<span style=color:#ae81ff>0.5</span>, vertexColor) <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>?</span> vertexColor <span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>-</span> vertexColor;
</span></span><span style=display:flex><span><span style=color:#66d9ef>half</span> adjustedHalfSampler <span style=color:#f92672>=</span> saturate(halfLambertAO <span style=color:#f92672>*</span> vertexOffset);
</span></span></code></pre></div><p>这里 AO的地方自定义（lightmap.g ）乘2用来获得对比度更加明显的AO效果_ShadowSmooth 用来调整亮部到暗部过度的明显程度，左边0.5，右侧1.0。</p><p><img src=image-20230219155213146.png alt=0.5><img src=image-20230219155240254.png alt=1></p><h3 id=wrapped-diffuse>Wrapped Diffuse</h3><p>回顾一下军团要塞2中Ramp使用方式</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-HLSL data-lang=HLSL><span style=display:flex><span><span style=color:#66d9ef>half4</span> ramp <span style=color:#f92672>=</span> SAMPLE_TEXTURE2D(_RampMap, sampler_RampMap, <span style=color:#66d9ef>half2</span>(halfLambert, <span style=color:#ae81ff>0</span>));
</span></span></code></pre></div><p>原神的衣服整体并不受环境光颜色直接影响，这里面需要计算是否是白天或者夜晚。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-HLSL data-lang=HLSL><span style=display:flex><span><span style=color:#75715e>// Day (0.5) or Night(0)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>half</span> dayOrNight <span style=color:#f92672>=</span> (<span style=color:#ae81ff>1</span> <span style=color:#f92672>-</span> step(<span style=color:#ae81ff>0.1</span>, _IsNight)) <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.5</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.03</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// diffuse = ramp + adjusted half lambert + AO</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>half</span> rampV <span style=color:#f92672>=</span> saturate(lightMap.a <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.45</span> <span style=color:#f92672>+</span> dayOrNight);
</span></span><span style=display:flex><span><span style=color:#66d9ef>half2</span> rampUV <span style=color:#f92672>=</span> <span style=color:#66d9ef>half2</span>(adjustedHalfSampler, rampV);
</span></span></code></pre></div><p>把ramp的V方向取值，0-0.5为 黑天，0.5-1为白天，取代军团要塞中V方向只有单条ramp取值。</p><h3 id=specular>Specular</h3><p>金属部分使用到metalMap高光，实现原理来自MatCap采样。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-HLSL data-lang=HLSL><span style=display:flex><span><span style=color:#75715e>// Metal Specular</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>half</span> metalMask <span style=color:#f92672>=</span> step(<span style=color:#ae81ff>0.95</span>, lightMap.r);
</span></span><span style=display:flex><span><span style=color:#66d9ef>half3</span> cameraForward <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>viewDirWS;
</span></span><span style=display:flex><span><span style=color:#66d9ef>half3</span> viewUpDir <span style=color:#f92672>=</span> mul(UNITY_MATRIX_I_V, <span style=color:#66d9ef>half4</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>)).xyz;
</span></span><span style=display:flex><span><span style=color:#66d9ef>half3</span> cameraRight <span style=color:#f92672>=</span> SafeNormalize(cross(viewUpDir, cameraForward));
</span></span><span style=display:flex><span><span style=color:#66d9ef>half3</span> cameraUp <span style=color:#f92672>=</span> SafeNormalize(cross(cameraForward, cameraRight));
</span></span><span style=display:flex><span><span style=color:#66d9ef>half2</span> metalMapUV <span style=color:#f92672>=</span> mul(<span style=color:#66d9ef>half3x3</span>(cameraRight, cameraUp, cameraForward), normalWS).xy <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.49</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.5</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>half4</span> metalMap <span style=color:#f92672>=</span> SAMPLE_TEXTURE2D(_MetalMap, sampler_MetalMap, metalMapUV);
</span></span><span style=display:flex><span><span style=color:#66d9ef>half4</span> metalSpecular <span style=color:#f92672>=</span> _MetalIntensity <span style=color:#f92672>*</span> metalMap <span style=color:#f92672>*</span> metalMask <span style=color:#f92672>*</span> albedo;
</span></span></code></pre></div><p>非金属部分使用常规的Blinn Phong高光</p><pre tabindex=0><code>half Ks = 0.96;
half  SpecularPow = exp2(lightMap.r * 11.0 + 2.0);
half  SpecularNorm = (SpecularPow + 8.0) / 8.0;
half4 SpecularColor = albedo * lightMap.g;
half SpecularContrib = albedo * (SpecularNorm * pow(ndotH, SpecularPow));
half4 nonMetalSpecular = SpecularColor * SpecularContrib  * ndotL* Ks * lightMap.b;
</code></pre><p><img src=image-20230219192536859.png alt></p><hr><p>自发光</p><p>这里我用自发光来描绘裸漏皮肤以及丝袜部分SSS材质的效果</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-HLSL data-lang=HLSL><span style=display:flex><span><span style=color:#75715e>// Emission (Fake SSS)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>half</span> emissionMask <span style=color:#f92672>=</span> albedo.a;
</span></span><span style=display:flex><span>emissionMask <span style=color:#f92672>*=</span> step(<span style=color:#ae81ff>0.65</span>, lightMap.a);
</span></span><span style=display:flex><span><span style=color:#75715e>// half time =  abs((frac(_Time.y * 0.5) - 0.5) * 2);</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>half4</span> emission <span style=color:#f92672>=</span> albedo <span style=color:#f92672>*</span> lightColor <span style=color:#f92672>*</span> emissionMask <span style=color:#f92672>*</span> _EmissionIntensity <span style=color:#f92672>*</span> _EmissionColor;
</span></span></code></pre></div><p><img src=image-20230219213213931.png alt></p><hr><h3 id=outline>Outline</h3><p>多开一个pass，平滑法线后back face沿着法线方向平移，都是基础做法。其实也可以用后处理来做。但是URP 2022才支持不用写后处理脚本，直接贴matertial上去，后面在尝试做一版吧。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-HLSL data-lang=HLSL><span style=display:flex><span>Pass 
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    Name <span style=color:#e6db74>&#34;OutLine&#34;</span>
</span></span><span style=display:flex><span>    Tags {<span style=color:#e6db74>&#34;LightMode&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;SRPDefaultUnlit&#34;</span>}
</span></span><span style=display:flex><span>    Cull front
</span></span><span style=display:flex><span>    HLSLPROGRAM
</span></span><span style=display:flex><span>    <span style=color:#960050;background-color:#1e0010>#</span>pragma vertex vert  
</span></span><span style=display:flex><span>    <span style=color:#960050;background-color:#1e0010>#</span>pragma fragment frag
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Varyings vert(Attributes IN) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>half4</span> scaledScreenParams <span style=color:#f92672>=</span> GetScaledScreenParams();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>half</span> ScaleX <span style=color:#f92672>=</span> abs(scaledScreenParams.x <span style=color:#f92672>/</span> scaledScreenParams.y);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Varyings OUT;
</span></span><span style=display:flex><span>        VertexPositionInputs vertexInput <span style=color:#f92672>=</span> GetVertexPositionInputs(IN.positionOS.xyz);
</span></span><span style=display:flex><span>        VertexNormalInputs normalInput <span style=color:#f92672>=</span> GetVertexNormalInputs(IN.normal);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>half3</span> normalCS <span style=color:#f92672>=</span> TransformWorldToHClipDir(normalInput.normalWS);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>half2</span> extendDis <span style=color:#f92672>=</span> normalize(normalCS.xy) <span style=color:#f92672>*</span> (<span style=color:#ae81ff>0.1</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.01</span>);
</span></span><span style=display:flex><span>        extendDis.x <span style=color:#f92672>/=</span>ScaleX ;
</span></span><span style=display:flex><span>        OUT.positionCS <span style=color:#f92672>=</span> vertexInput.positionCS;
</span></span><span style=display:flex><span>        OUT.positionCS.xy <span style=color:#f92672>+=</span>extendDis;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> OUT;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>half4</span> frag(Varyings IN) <span style=color:#f92672>:</span> <span style=color:#a6e22e>SV_Target</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>float4</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ENDHLSL
</span></span><span style=display:flex><span>}	
</span></span></code></pre></div><p><img src=image-20230220104936235.png alt></p><hr><h2 id=暂时效果>暂时效果</h2><p><img src=image-20230220105004875.png alt></p><p>还缺少深度空间边缘光，哦对头发的高光也应该额外处理，留个坑以后去实现。</p><h2 id=参考>参考</h2><ol><li><a href=https://zhuanlan.zhihu.com/p/551104542>【01】Unity URP 卡通渲染 原神角色渲染记录-Diffuse: Ramp + AO + Double Shadow - 知乎 (zhihu.com)</a></li><li><a href=https://zhuanlan.zhihu.com/p/435005339>【Unity技术美术】 原神Shader渲染还原解析 - 知乎 (zhihu.com)</a></li><li>[<a href=https://zhuanlan.zhihu.com/p/547129280>卡通渲染]二、原神角色渲染还原 - Diffuse-1 - 知乎 (zhihu.com)</a></li><li><a href=https://zhuanlan.zhihu.com/p/360229590>原神角色渲染Shader分析还原 - 知乎 (zhihu.com)</a></li><li><a href=https://zhuanlan.zhihu.com/p/110025903>【02】从零开始的卡通渲染-着色篇1 - 知乎 (zhihu.com)</a></li><li>[<a href=https://zhuanlan.zhihu.com/p/551629982>卡通渲染]等宽屏幕空间边缘光 - 知乎 (zhihu.com)</a></li></ol></div><div class=post-text-bottom><div class=social-share data-title=URP仿原神渲染shader data-url=https://kampter.github.io/blog/urp%E4%BB%BF%E5%8E%9F%E7%A5%9E%E6%B8%B2%E6%9F%93shader/><span>Share:</span>
<a class="share-btn share-btn-facebook share-btn-1" title="Share on Facebook"><i class="ion ion-social-facebook"></i></a>
<a class="share-btn share-btn-twitter share-btn-2" title="Share on Twitter"><i class="ion ion-social-twitter"></i></a>
<a class="share-btn share-btn-linkedin share-btn-3" title="Share on Linkedin"><i class="ion ion-social-linkedin"></i></a>
<a class="share-btn share-btn-reddit share-btn-4" title="Share on Reddit"><i class="ion ion-social-reddit"></i></a>
<a class="share-btn share-btn-pinterest share-btn-5" title="Share on Pinterest"><i class="ion ion-social-pinterest"></i></a></div><div class=tags-links>Tags:
<a href=https://kampter.github.io/tags/toon-shading/ rel=tag>Toon Shading</a>
<a href=https://kampter.github.io/tags/unity/ rel=tag>Unity</a>
<a href=https://kampter.github.io/tags/hlsl/ rel=tag>HLSL</a></div></div><div class=post-navigation role=navigation><div class=nav-previous><a href=https://kampter.github.io/blog/games-202-%E7%8E%AF%E5%A2%83%E5%85%89%E7%85%A7/ rel=prev title="Games 202 环境光照"><span class="post-nav-next post-nav-text">Prev</span></a></div><div class=nav-next><a href=https://kampter.github.io/blog/%E5%B0%9D%E8%AF%95%E5%9C%A8urp%E4%B8%AD%E6%89%8B%E5%86%99-pbr-shader/ rel=next title="尝试在URP下手写 PBR shader"><span class="post-nav-prev post-nav-text">Next</span></a></div></div></div></div></div><div class=title>Comments</div><div class="row border-line-v"><div class="col col-m-12 col-t-12 col-d-12"><div class=post-box><div class=col-md-12><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://kampter.github.io/blog/urp%E4%BB%BF%E5%8E%9F%E7%A5%9E%E6%B8%B2%E6%9F%93shader/",this.page.identifier="1e0da9b235a94ab9a52a544754901c6e"};(function(){var e=document,t=e.createElement("script");t.src="https://kampterblog.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div></div></div></div></div></div></div></div><script src=https://kampter.github.io/plugins/jQuery/jquery.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.6.2/fuse.min.js integrity="sha512-Nqw1tH3mpavka9cQCc5zWWEZNfIPdOYyQFjlV1NvflEtQ0/XI6ZQ+H/D3YgJdqSUJlMLAPRj/oXlaHCFbFCjoQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://kampter.github.io/plugins/search/simple-search.js></script>
<script src=https://kampter.github.io/plugins/validate/jquery.validate.min.js></script>
<script src=https://kampter.github.io/plugins/owl-carousel/owl.carousel.js></script>
<script src=https://kampter.github.io/plugins/magnific-popup/magnific-popup.min.js></script>
<script src=https://kampter.github.io/plugins/slimscroll/jquery.slimscroll.js></script>
<script src=https://kampter.github.io/plugins/imagesloaded/imagesloaded.pkgd.min.js></script>
<script src=https://kampter.github.io/plugins/isotope/isotope.pkgd.js></script>
<script src=https://kampter.github.io/plugins/typed/typed.js></script>
<script src=https://kampter.github.io/plugins/rrssb/rrssb.js></script>
<script src=https://kampter.github.io/js/form-handler.min.js></script>
<script src=https://kampter.github.io/js/common.min.js></script></body></html>